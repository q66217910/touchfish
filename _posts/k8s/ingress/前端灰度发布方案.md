---
layout: post
title: 前端灰度发布方案
category: k8s
tags: [k8s]
no-post-nav: true
---

# 前端灰度发布方案

### 1.配置ingress-nginx的annotations

ingress-nginx中支持金丝雀发布,
* nginx.ingress.kubernetes.io/canary: 是否启用金丝雀发布
* nginx.ingress.kubernetes.io/canary-by-header: 判断是否进行金丝雀路由的请求头
* nginx.ingress.kubernetes.io/canary-by-header-value: 当(canary-by-header)请求头的值匹配值时路由
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: ingress-nginx
  annotations:
    nginx.ingress.kubernetes.io/canary: "true"
    nginx.ingress.kubernetes.io/canary-by-header: "sp-canary"
    nginx.ingress.kubernetes.io/canary-by-header-value: "true"
```

[相关ingress-nginx文档](https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configuration/annotations/#canary)


### 2.