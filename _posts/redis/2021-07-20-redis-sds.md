---
layout: post
title: REDIS 数据类型之 SDS
category: redis
tags: [redis]
no-post-nav: true
---

REDIS 数据类型之 SDS
===

SDS分配一段连续的内存来存储动态字符串



### 1.SDS的数据结构

- **len:**  记录buf数组中已使用字节的数量 , 等于 SDS 保存字符串的长度.
- **alloc:** 分配的字符数量
- **flags:** 类型标志位
- **buf[]:** 存储的字符串内容

```c
typedef char *sds;

//SDS的类型
define SDS_TYPE_5  0
define SDS_TYPE_8  1
define SDS_TYPE_16 2
define SDS_TYPE_32 3
define SDS_TYPE_64 4

//适配不同长度
struct __attribute__ ((__packed__)) sdshdr8 {
    uint8_t len; //字符串真实长度，不包括终止符
    uint8_t alloc;  //字符串最大容量，不包括终止符
    unsigned char flags; //head的类型
    char buf[]; //字符串主体
};
struct __attribute__ ((__packed__)) sdshdr16 {
    uint16_t len;
    uint16_t alloc; 
    unsigned char flags;
    char buf[];
};
struct __attribute__ ((__packed__)) sdshdr32 {
    uint32_t len; 
    uint32_t alloc;
    unsigned char flags; 
    char buf[];
};
struct __attribute__ ((__packed__)) sdshdr64 {
    uint64_t len; 
    uint64_t alloc;
    unsigned char flags;
    char buf[];
};
```

